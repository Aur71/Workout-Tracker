<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Workout_Tracker.ViewModel"
             xmlns:model="clr-namespace:Workout_Tracker.Model"
             x:Class="Workout_Tracker.View.ProgramListPage"
             x:DataType="vm:ProgramListViewModel"
             BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource OffBlack}}"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="*,Auto">
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="16">

                <!-- Header -->
                <Label Text="Programs"
                       FontSize="28"
                       FontAttributes="Bold"
                       Padding="0,20,0,8"
                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />

                <!-- Empty State -->
                <Label Text="No programs yet. Tap + to create one!"
                       FontSize="14"
                       TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                       HorizontalOptions="Center"
                       Padding="0,40"
                       IsVisible="{Binding IsEmpty}" />

                <!-- Active Programs Section -->
                <VerticalStackLayout Spacing="12"
                                     IsVisible="{Binding HasActive}">
                    <Label Text="Active"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />

                    <VerticalStackLayout BindableLayout.ItemsSource="{Binding ActivePrograms}"
                                         Spacing="12">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="model:ProgramDisplay">
                                <Border StrokeThickness="0"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource CardBackground}}"
                                        Padding="16">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="16" />
                                    </Border.StrokeShape>
                                    <Border.Shadow>
                                        <Shadow Brush="{StaticResource BlackBrush}"
                                                Offset="0,2"
                                                Radius="8"
                                                Opacity="0.08" />
                                    </Border.Shadow>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ProgramListViewModel}}, Path=GoToDetailCommand}"
                                                              CommandParameter="{Binding}" />
                                    </Border.GestureRecognizers>

                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                                        <!-- Program Header -->
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <Border StrokeThickness="0"
                                                    WidthRequest="4"
                                                    HeightRequest="40"
                                                    BackgroundColor="{Binding BarColor}">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="2" />
                                                </Border.StrokeShape>
                                            </Border>
                                            <VerticalStackLayout Grid.Column="1" Spacing="2" Margin="12,0,0,0">
                                                <Label Text="{Binding Name}"
                                                       FontSize="18"
                                                       FontAttributes="Bold"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                                <Label Text="{Binding Goal}"
                                                       FontSize="13"
                                                       IsVisible="{Binding HasGoal}"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                            </VerticalStackLayout>
                                            <Border Grid.Column="2"
                                                    StrokeThickness="0"
                                                    Padding="8,4"
                                                    VerticalOptions="Center"
                                                    BackgroundColor="{AppThemeBinding Light=#E8FFF6, Dark=#1A3D33}">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="6" />
                                                </Border.StrokeShape>
                                                <Label Text="Active"
                                                       FontSize="11"
                                                       FontAttributes="Bold"
                                                       VerticalOptions="Center"
                                                       TextColor="{StaticResource Primary}" />
                                            </Border>
                                        </Grid>

                                        <!-- Date Range -->
                                        <HorizontalStackLayout Grid.Row="1" Spacing="8">
                                            <Label Text="{Binding DateRangeDisplay}"
                                                   FontSize="13"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                            <Label Text="路"
                                                   FontSize="13"
                                                   IsVisible="{Binding HasDuration}"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}" />
                                            <Label Text="{Binding DurationDisplay}"
                                                   FontSize="13"
                                                   IsVisible="{Binding HasDuration}"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                        </HorizontalStackLayout>

                                        <!-- Progress Bar (only for programs with end date) -->
                                        <Grid Grid.Row="2" RowDefinitions="Auto,Auto" RowSpacing="6"
                                              IsVisible="{Binding HasDuration}">
                                            <Grid ColumnDefinitions="*,Auto">
                                                <Label Text="{Binding WeekProgressDisplay}"
                                                       FontSize="12"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                                <Label Grid.Column="1"
                                                       Text="{Binding ProgressPercentDisplay}"
                                                       FontSize="12"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Primary}" />
                                            </Grid>
                                            <Border Grid.Row="1"
                                                    StrokeThickness="0"
                                                    HeightRequest="6"
                                                    BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark=#252525}">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="3" />
                                                </Border.StrokeShape>
                                                <ProgressBar Progress="{Binding ProgressFraction}"
                                                             ProgressColor="{StaticResource Primary}"
                                                             HeightRequest="6" />
                                            </Border>
                                        </Grid>

                                        <!-- Stats (static for now) -->
                                        <HorizontalStackLayout Grid.Row="3" Spacing="16">
                                            <Label Text="0 sessions"
                                                   FontSize="13"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                            <Label Text="路"
                                                   FontSize="13"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}" />
                                            <Label Text="0 completed"
                                                   FontSize="13"
                                                   TextColor="{StaticResource Primary}" />
                                        </HorizontalStackLayout>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- Upcoming Programs Section -->
                <VerticalStackLayout Spacing="12"
                                     IsVisible="{Binding HasUpcoming}">
                    <Label Text="Upcoming"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />

                    <VerticalStackLayout BindableLayout.ItemsSource="{Binding UpcomingPrograms}"
                                         Spacing="12">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="model:ProgramDisplay">
                                <Border StrokeThickness="0"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource CardBackground}}"
                                        Padding="16">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="16" />
                                    </Border.StrokeShape>
                                    <Border.Shadow>
                                        <Shadow Brush="{StaticResource BlackBrush}"
                                                Offset="0,2"
                                                Radius="8"
                                                Opacity="0.08" />
                                    </Border.Shadow>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ProgramListViewModel}}, Path=GoToDetailCommand}"
                                                              CommandParameter="{Binding}" />
                                    </Border.GestureRecognizers>

                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                        <Border StrokeThickness="0"
                                                WidthRequest="4"
                                                HeightRequest="40"
                                                BackgroundColor="{Binding BarColor}">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="2" />
                                            </Border.StrokeShape>
                                        </Border>
                                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                                            <Label Text="{Binding Name}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                            <HorizontalStackLayout Spacing="8">
                                                <Label Text="{Binding DateRangeDisplay}"
                                                       FontSize="13"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                                <Label Text="路"
                                                       FontSize="13"
                                                       IsVisible="{Binding HasDuration}"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}" />
                                                <Label Text="{Binding DurationDisplay}"
                                                       FontSize="13"
                                                       IsVisible="{Binding HasDuration}"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- Completed Programs Section -->
                <VerticalStackLayout Spacing="12"
                                     IsVisible="{Binding HasCompleted}">
                    <Label Text="Completed"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />

                    <VerticalStackLayout BindableLayout.ItemsSource="{Binding CompletedPrograms}"
                                         Spacing="12">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="model:ProgramDisplay">
                                <Border StrokeThickness="0"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource CardBackground}}"
                                        Padding="16">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="16" />
                                    </Border.StrokeShape>
                                    <Border.Shadow>
                                        <Shadow Brush="{StaticResource BlackBrush}"
                                                Offset="0,2"
                                                Radius="8"
                                                Opacity="0.08" />
                                    </Border.Shadow>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ProgramListViewModel}}, Path=GoToDetailCommand}"
                                                              CommandParameter="{Binding}" />
                                    </Border.GestureRecognizers>

                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                        <Border StrokeThickness="0"
                                                WidthRequest="4"
                                                HeightRequest="40"
                                                BackgroundColor="{Binding BarColor}">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="2" />
                                            </Border.StrokeShape>
                                        </Border>
                                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                                            <Label Text="{Binding Name}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                            <HorizontalStackLayout Spacing="8">
                                                <Label Text="{Binding DateRangeDisplay}"
                                                       FontSize="13"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                                <Label Text="路"
                                                       FontSize="13"
                                                       IsVisible="{Binding HasDuration}"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}" />
                                                <Label Text="{Binding DurationDisplay}"
                                                       FontSize="13"
                                                       IsVisible="{Binding HasDuration}"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>
                                        <Label Grid.Column="2"
                                               Text="&#x2713;"
                                               FontSize="18"
                                               TextColor="{StaticResource Success}"
                                               VerticalOptions="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </VerticalStackLayout>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Floating Action Button -->
        <Border Grid.Row="1"
                StrokeThickness="0"
                WidthRequest="56"
                HeightRequest="56"
                Margin="0,0,20,24"
                HorizontalOptions="End"
                BackgroundColor="{StaticResource Primary}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="28" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="{StaticResource BlackBrush}"
                        Offset="0,4"
                        Radius="12"
                        Opacity="0.2" />
            </Border.Shadow>
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding GoToAddCommand}" />
            </Border.GestureRecognizers>
            <Label Text="+"
                   FontSize="28"
                   TextColor="{StaticResource Black}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />
        </Border>
    </Grid>

</ContentPage>
