<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Workout_Tracker.ViewModel"
             xmlns:model="clr-namespace:Workout_Tracker.Model"
             x:Class="Workout_Tracker.View.WorkoutListPage"
             x:DataType="vm:WorkoutListViewModel"
             BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource OffBlack}}"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="*,Auto">
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="16">

                <!-- Header -->
                <Label Text="Workouts"
                       FontSize="28"
                       FontAttributes="Bold"
                       Padding="0,20,0,0"
                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />

                <!-- Search Bar -->
                <Border StrokeThickness="1"
                        Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                        Padding="12,0"
                        BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource CardBackground}}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10" />
                    </Border.StrokeShape>
                    <Grid ColumnDefinitions="Auto,*">
                        <Label Text="&#x1F50D;"
                               FontSize="16"
                               VerticalOptions="Center"
                               TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}" />
                        <Entry Grid.Column="1"
                               Placeholder="Search workouts..."
                               Text="{Binding SearchText}"
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                               Margin="8,0,0,0" />
                    </Grid>
                </Border>

                <!-- Workout List -->
                <CollectionView ItemsSource="{Binding Workouts}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.EmptyView>
                        <Label Text="No workouts yet. Tap + to create one!"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                               HorizontalOptions="Center"
                               Padding="0,40" />
                    </CollectionView.EmptyView>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:WorkoutDisplay">
                            <Border StrokeThickness="0"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource CardBackground}}"
                                    Padding="16">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource BlackBrush}"
                                            Offset="0,2"
                                            Radius="8"
                                            Opacity="0.08" />
                                </Border.Shadow>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:WorkoutListViewModel}}, Path=GoToDetailCommand}"
                                                          CommandParameter="{Binding}" />
                                </Border.GestureRecognizers>

                                <Grid RowDefinitions="Auto,Auto" RowSpacing="12">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Text="{Binding Name}"
                                               FontSize="17"
                                               FontAttributes="Bold"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                        <Border Grid.Column="1"
                                                StrokeThickness="0"
                                                Padding="8,4"
                                                IsVisible="{Binding HasGoal}"
                                                BackgroundColor="{Binding GoalBadgeBg}">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="6" />
                                            </Border.StrokeShape>
                                            <Label Text="{Binding GoalDisplay}"
                                                   FontSize="11"
                                                   TextColor="{Binding GoalBadgeTextColor}" />
                                        </Border>
                                    </Grid>
                                    <HorizontalStackLayout Grid.Row="1" Spacing="16">
                                        <Label Text="{Binding DurationDisplay}"
                                               FontSize="13"
                                               IsVisible="{Binding DurationDisplay, Converter={StaticResource StringNotEmptyConverter}}"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                        <Label Text="{Binding ExerciseCountDisplay}"
                                               FontSize="13"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                    </HorizontalStackLayout>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Floating Action Button -->
        <Border Grid.Row="1"
                StrokeThickness="0"
                WidthRequest="56"
                HeightRequest="56"
                Margin="0,0,20,24"
                HorizontalOptions="End"
                BackgroundColor="{StaticResource Primary}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="28" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="{StaticResource BlackBrush}"
                        Offset="0,4"
                        Radius="12"
                        Opacity="0.2" />
            </Border.Shadow>
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding GoToAddCommand}" />
            </Border.GestureRecognizers>
            <Label Text="+"
                   FontSize="28"
                   TextColor="{StaticResource Black}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />
        </Border>
    </Grid>

</ContentPage>
