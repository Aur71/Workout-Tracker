<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Workout_Tracker.ViewModel"
             xmlns:model="clr-namespace:Workout_Tracker.Model"
             x:Class="Workout_Tracker.View.LogListPage"
             x:DataType="vm:LogListViewModel"
             BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource OffBlack}}"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="*,Auto">
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="16">

                <!-- Header -->
                <Label Text="Logs"
                       FontSize="28"
                       FontAttributes="Bold"
                       Padding="0,20,0,8"
                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />

                <!-- Empty State -->
                <Label Text="No logs yet. Tap + to add one!"
                       FontSize="14"
                       TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                       HorizontalOptions="Center"
                       Padding="0,40"
                       IsVisible="{Binding IsEmpty}" />

                <!-- Grouped Logs -->
                <VerticalStackLayout BindableLayout.ItemsSource="{Binding LogGroups}"
                                     Spacing="20">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="model:LogGroup">
                            <VerticalStackLayout Spacing="12">

                                <!-- Date Header -->
                                <Label Text="{Binding DateHeader}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />

                                <!-- Log Entries -->
                                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Entries}"
                                                     Spacing="12">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate x:DataType="model:LogEntry">
                                            <SwipeView>
                                                <SwipeView.RightItems>
                                                    <SwipeItems>
                                                        <SwipeItem Text="Delete"
                                                                   BackgroundColor="{StaticResource Danger}"
                                                                   Command="{Binding Source={RelativeSource AncestorType={x:Type vm:LogListViewModel}}, Path=DeleteLogCommand}"
                                                                   CommandParameter="{Binding}" />
                                                    </SwipeItems>
                                                </SwipeView.RightItems>

                                                <Border StrokeThickness="0"
                                                        BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource CardBackground}}"
                                                        Padding="16">
                                                    <Border.StrokeShape>
                                                        <RoundRectangle CornerRadius="16" />
                                                    </Border.StrokeShape>
                                                    <Border.Shadow>
                                                        <Shadow Brush="{StaticResource BlackBrush}"
                                                                Offset="0,2"
                                                                Radius="8"
                                                                Opacity="0.08" />
                                                    </Border.Shadow>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:LogListViewModel}}, Path=GoToEditCommand}"
                                                                              CommandParameter="{Binding}" />
                                                    </Border.GestureRecognizers>

                                                    <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
                                                        <!-- Row 0: Summary + Badge -->
                                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                                            <Label Text="{Binding Summary}"
                                                                   FontSize="15"
                                                                   FontAttributes="Bold"
                                                                   VerticalOptions="Center"
                                                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                                            <Border Grid.Column="1"
                                                                    StrokeThickness="0"
                                                                    Padding="10,4"
                                                                    VerticalOptions="Center"
                                                                    BackgroundColor="{Binding TypeBadgeBg}">
                                                                <Border.StrokeShape>
                                                                    <RoundRectangle CornerRadius="8" />
                                                                </Border.StrokeShape>
                                                                <Label Text="{Binding TypeDisplay}"
                                                                       FontSize="11"
                                                                       FontAttributes="Bold"
                                                                       TextColor="{Binding TypeBadgeTextColor}" />
                                                            </Border>
                                                        </Grid>

                                                        <!-- Row 1: Time -->
                                                        <Label Grid.Row="1"
                                                               Text="{Binding DateDisplay}"
                                                               FontSize="13"
                                                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                                    </Grid>
                                                </Border>
                                            </SwipeView>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </VerticalStackLayout>

                            </VerticalStackLayout>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Floating Action Button -->
        <Border Grid.Row="1"
                StrokeThickness="0"
                WidthRequest="56"
                HeightRequest="56"
                Margin="0,0,20,24"
                HorizontalOptions="End"
                BackgroundColor="{StaticResource Primary}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="28" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="{StaticResource BlackBrush}"
                        Offset="0,4"
                        Radius="12"
                        Opacity="0.2" />
            </Border.Shadow>
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding GoToAddCommand}" />
            </Border.GestureRecognizers>
            <Label Text="+"
                   FontSize="28"
                   TextColor="{StaticResource Black}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />
        </Border>
    </Grid>

</ContentPage>
